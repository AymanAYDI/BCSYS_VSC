OBJECT XMLport 50023 Yooz Import Payable NY
{
  OBJECT-PROPERTIES
  {
    Date=07/01/16;
    Time=16:40:03;
    Modified=Yes;
    Version List=JX-VSC2.0-AUD,JX-YOOZ2;
  }
  PROPERTIES
  {
    Permissions=TableData 25=rm,
                TableData 112=rm,
                TableData 114=rm,
                TableData 122=rm,
                TableData 124=rm;
    CaptionML=[ENU=Yooz Import Payable NY;
               FRA=Yooz import facture payable ex. suivant];
    Direction=Import;
    OnPreXMLport=BEGIN
                   CASE COMPANYNAME OF
                    'VFEC':
                      CompName := 'VSCG';
                    'Agence':
                      CompName := 'AGVSC';
                    'VSC':
                      CompName := 'VSC';
                    'VSCT' :
                      CompName := 'VSCT';
                   END;
                 END;

    OnPostXMLport=BEGIN
                    IF NbOComp = 0 THEN
                     MESSAGE(STRSUBSTNO(Text001,NbOk,NbOkAv))
                    ELSE
                     MESSAGE(STRSUBSTNO(Text002,NbOk,NbOComp,OComp));
                  END;

    Format=Variable Text;
    FieldDelimiter=<None>;
    FieldSeparator=[;];
    UseRequestPage=No;
    FileName=*.csv;
  }
  ELEMENTS
  {
    { [{094334DF-AEC4-412C-A997-2E9B5399152E}];  ;Root                ;Element ;Text     }

    { [{DB1FE33B-21D4-4D7C-BC3F-444CC636876B}];1 ;Yooz                ;Element ;Table   ;
                                                  SourceTable=Table2000000026;
                                                  AutoSave=No;
                                                  AutoUpdate=No;
                                                  AutoReplace=No;
                                                  Import::OnBeforeInsertRecord=BEGIN
                                                                                 Gint_Compteur :=  Gint_Compteur + 1;
                                                                                 IF  (Gint_Compteur > 1) THEN BEGIN
                                                                                  IF Gtext_Champ1 = CompName THEN BEGIN
                                                                                   // V‚rification Facture / Facture enregistr‚e
                                                                                   IF COPYSTR(Gtext_Champ2,1,3) = 'FAP' THEN BEGIN
                                                                                    IF Grec_PurchaseHeader.GET(Grec_PurchaseHeader."Document Type"::Invoice,Gtext_Champ2) THEN BEGIN
                                                                                     Grec_PurchaseHeader."Yooz No." := Gtext_Champ9; //Nø Yooz
                                                                                     Grec_PurchaseHeader."Yooz Token link" := Gtext_Champ10; //Lien Token Yooz
                                                                                     Grec_PurchaseHeader.MODIFY;
                                                                                     NbOk += 1;
                                                                                    END;
                                                                                   END ELSE BEGIN
                                                                                    IF Grec_PurchaseHeader.GET(Grec_PurchaseHeader."Document Type"::"Credit Memo",Gtext_Champ2) THEN BEGIN
                                                                                     Grec_PurchaseHeader."Yooz No." := Gtext_Champ9; //Nø Yooz
                                                                                     Grec_PurchaseHeader."Yooz Token link" := Gtext_Champ10; //Lien Token Yooz
                                                                                     Grec_PurchaseHeader.MODIFY;
                                                                                     NbOkAv += 1;
                                                                                    END ELSE BEGIN
                                                                                     IF Grec_PurchInvHeader.GET(Gtext_Champ2) THEN BEGIN
                                                                                      Grec_PurchInvHeader."Yooz No." := Gtext_Champ9; //Nø Yooz
                                                                                      Grec_PurchInvHeader."Yooz Token link" := Gtext_Champ10; //Lien Token Yooz
                                                                                      Grec_PurchInvHeader.MODIFY;
                                                                                      NbOk += 1;
                                                                                      Grec_VendLedgEntry.RESET;
                                                                                      Grec_VendLedgEntry.SETCURRENTKEY("Vendor No.","Document No.","Posting Date");
                                                                                      Grec_VendLedgEntry.SETRANGE("Vendor No.",Grec_PurchInvHeader."Pay-to Vendor No.");
                                                                                      Grec_VendLedgEntry.SETRANGE("Document No.",Grec_PurchInvHeader."No.");
                                                                                      Grec_VendLedgEntry.SETRANGE("Document Type",Grec_VendLedgEntry."Document Type"::Invoice);
                                                                                      IF Grec_VendLedgEntry.FINDFIRST THEN BEGIN
                                                                                       Grec_VendLedgEntry."Yooz No." := Gtext_Champ9;
                                                                                       Grec_VendLedgEntry."Yooz Token link" := Gtext_Champ10;
                                                                                       Grec_VendLedgEntry.MODIFY;
                                                                                      END;
                                                                                     END ELSE BEGIN
                                                                                      IF Grec_PurchCrMemoHeader.GET(Gtext_Champ2) THEN BEGIN
                                                                                       Grec_PurchCrMemoHeader."Yooz No." := Gtext_Champ9; //Nø Yooz
                                                                                       Grec_PurchCrMemoHeader."Yooz Token link" := Gtext_Champ10; //Lien Token Yooz
                                                                                       Grec_PurchCrMemoHeader.MODIFY;
                                                                                       NbOkAv += 1;
                                                                                       Grec_VendLedgEntry.RESET;
                                                                                       Grec_VendLedgEntry.SETCURRENTKEY("Vendor No.","Document No.","Posting Date");
                                                                                       Grec_VendLedgEntry.SETRANGE("Vendor No.",Grec_PurchInvHeader."Pay-to Vendor No.");
                                                                                       Grec_VendLedgEntry.SETRANGE("Document No.",Grec_PurchInvHeader."No.");
                                                                                       Grec_VendLedgEntry.SETRANGE("Document Type",Grec_VendLedgEntry."Document Type"::"Credit Memo");
                                                                                       IF Grec_VendLedgEntry.FINDFIRST THEN BEGIN
                                                                                        Grec_VendLedgEntry."Yooz No." := Gtext_Champ9;
                                                                                        Grec_VendLedgEntry."Yooz Token link" := Gtext_Champ10;
                                                                                        Grec_VendLedgEntry.MODIFY;
                                                                                       END;
                                                                                      END;
                                                                                     END;
                                                                                    END;
                                                                                   END;
                                                                                  END;
                                                                                 END;
                                                                               END;
                                                                                }

    { [{18A2A756-F084-4EBF-8689-60C1DC266417}];2 ;Gtext_Champ1        ;Element ;Text    ;
                                                  VariableName=Gtext_Champ1 }

    { [{8A165EA3-3DB4-4384-80C2-4455C4A92525}];2 ;Gtext_Champ2        ;Element ;Text    ;
                                                  VariableName=Gtext_Champ2 }

    { [{E7F11536-25A9-4369-90FA-FE33E50491C2}];2 ;Gtext_Champ9        ;Element ;Text    ;
                                                  VariableName=Gtext_Champ9 }

    { [{C387EFAA-E991-4730-BD05-6C463FE23B18}];2 ;Gtext_Champ10       ;Element ;Text    ;
                                                  VariableName=Gtext_Champ10 }

  }
  EVENTS
  {
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      Gint_Compteur@1000000006 : Integer;
      Grec_PurchaseHeader@1000000005 : Record 38;
      Grec_PurchaseHeader2@1000000004 : Record 38;
      Grec_PurchInvHeader@1000000013 : Record 122;
      Grec_PurchCrMemoHeader@1000000014 : Record 124;
      Grec_VendLedgEntry@1000000015 : Record 25;
      Grec_PostingDate@1000000003 : Date;
      Grec_DocumentDate@1000000002 : Date;
      Gdec_AmoutExlVAT@1000000001 : Decimal;
      Grec_ReceiptInvoiceDate@1000000000 : Date;
      Text001@1000000008 : TextConst 'ENU=Yooz Invoices are integrated;FRA=%1 facture(s) Yooz import‚e(s). %2 avoir(s) import‚(s).';
      NbOk@1000000007 : Integer;
      NbOkAv@1000000016 : Integer;
      NbOComp@1000000009 : Integer;
      Text002@1000000010 : TextConst 'FRA=%1 facture(s) Yooz import‚e(s).\%2 facture(s) … importer dans les soci‚t‚s %3.';
      OComp@1000000011 : Text;
      CompName@1000000012 : Text;

    BEGIN
    {

      //JX-VSC2.0-AUD
      //Import Facture achat Yooz

      // JX-YOOZ2 13/11/15 Ajout Gtext_Champ12 avec le type document
    }
    END.
  }
}

